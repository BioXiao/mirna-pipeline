Adapter Trimming
Andy Chu, achu@bcgsc.ca
Last edited 28/03/2011

	This script trims adapter sequence off the 3' end of reads, which is necessary when sequencing small RNAs. The primary focus at the GSC is miRNA processing.
	
HOW TO RUN

	Perl, with the String::Approx library	(http://search.cpan.org/dist/String-Approx/) is required.

	adapter_trim.pl is the interface to the adapter_trim.pm library for Illumina sequenced reads. It reads a qseq file from STDIN, and prints the trimmed read out to STDOUT. Input arguments are the adapter sequence, and an optional file location for the summary report (default is ./adapter_report.txt). A summary of the number of reads of each read length after trimming is written out to the summary report.

DESCRIPTION

	Before any alignment can occur, some preprocessing on the sequences is necessary. MiRNAs tend to be shorter than the length of reads generated by sequencers, which means that the read will sequence past biological RNA into the 3' adapter of the sequencing protocol. This non-biological sequence at the end of the read will make it difficult for the aligner to align the read, so it is trimmed off first.
	
	The adapter trimming works by looking for as much of the specified adapter sequence in the read as possible, allowing mismatches based on the length of adapter found. Only the first 15 bases of the adapter sequence are used for the string matching, regardless of the length of the adapter sequence supplied. If a read matches 15bp of non-biological adapter, it is safe to assume the sequence truly is adapter sequence.
	
	For each read, the algorithm first checks if it is an adapter dimer by checking if the adapter sequence is at the start of the read. Since it has been seen in indexed reads that the first few bases of the adapter can be lost, not only is the full adapter sequence matched, the adapter sequence with the first 1, 2, and 3 bases trimmed off the beginning is also matched. If the read is not an adapter dimer, then the algorithm tries to match the 15 bases of adapter anywhere along the read, starting from the end. When matching the full 15bp of adapter, any match with up to 2 mismatches is accepted. If the full 15bp is not found, decreasing lengths of adapter, down to the first 8 bases, is checked with 1 mismatch allowed. If a match is still not found, 7 down to 1 base of adapter is checked with an exact match required. The algorithm will trim 1 base off the end of a read if it happens to match the first base of the adapter. This is because it is better to get a perfect alignment than an alignment with potentially 1 mismatch. In addition, if only 1 base of adapter was found, the read is likely not a miRNA and would not be a concern anyway.
	
	After each read has been processed, a report is generated containing the number of reads at each read length. Any read that is under 15bp after trimming is discarded, the rest is sent to alignment. 15bp is chosen because it is the shortest mature miRNA in miRBase.

